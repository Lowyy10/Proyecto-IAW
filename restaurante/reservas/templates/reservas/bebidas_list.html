{% extends 'base.html' %}

{% load static %}

{% block content %}
    <h1 class="text-center mb-4">Bebidas</h1>
    <div class="container">
        <div class="row">
            {% if photos %}
                {% for bebida in photos %}
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title">{{ bebida.nom_bebida }}</h3>
                                <p><strong>Precio:</strong> {{ bebida.precio_bebida }}€</p>
                                <p><strong>Tipos de bebida:</strong> 
                                    {% for tipo in bebida.tipo_bebi.all %}
                                        {{ tipo.tipo_bebida }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                <p><strong>Valoración Media:</strong> 
                                    {% if bebida.media_valoracion %}
                                        {{ bebida.media_valoracion }} estrellas
                                    {% else %}
                                        No hay valoraciones aún.
                                    {% endif %}
                                </p>
                                {% if bebida.image %}
                                    <div style="position: relative; display: inline-block;">
                                        <img src="{{ bebida.image.url }}" alt="{{ bebida.nom_bebida }}" style="max-width: 200px; max-height: 200px; cursor: pointer;" onclick="document.getElementById('valoracion-form-{{ bebida.id }}').style.display='block'">
                                        <form id="valoracion-form-{{ bebida.id }}" action="" method="POST" style="display: none;">
                                            {% csrf_token %}
                                            {{ valoracion_form.as_p }}
                                            <input type="hidden" name="bebida_id" value="{{ bebida.id }}">
                                            <button type="submit" class="btn btn-primary mt-2">Enviar Valoración</button>
                                        </form>
                                    </div>
                                {% else %}
                                    <p>No hay imagen disponible</p>
                                {% endif %}
                                
                                <!-- Mostrar las valoraciones del usuario -->
                                <h4>Mis Valoraciones:</h4>
                                {% for valoracion in bebida.valoraciones.all %}
                                    <div>
                                        <strong>{{ valoracion.usuario.username }}</strong> - 
                                        {{ valoracion.valoracion }} estrellas
                                        {% if valoracion.usuario == request.user %}
                                            <form action="{% url 'valoracion_eliminar' valoracion.id %}" method="post" style="display:inline;">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger btn-sm">Eliminar Valoración</button>
                                            </form>
                                        {% endif %}
                                    </div>
                                {% empty %}
                                    <p>No has valorado esta bebida.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <br>
                    <hr size="2px" color="red" />
                    <br>
                {% endfor %}
            {% else %}
                <p class="text-center">No hay bebidas disponibles en este momento.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
